<?xml version="1.0" encoding="UTF-8"?>
<package>
	
	<panel name="main_chat_sleeper" noclick="1" />
	
	<template name="chat_window_channel_channel_template" >
		<panel noclick="1" > 
			<panel noclick="1" height="36s" color="0.2 0.2 0.4 1" > <!-- Channel Header -->
				<panel noclick="1" > <!-- Icon -->
				</panel> 
				<panel noclick="1" > <!-- Name and Status -->
				
				</panel>
				<panel noclick="1" > <!-- Options -->
				
					<!-- Memberlist Btn -->
					<panel name="chat_window_channel_memberlist_parent_{type}_{channelID}" x="-45s" width="85s" height="25s" align="right" valign="center" noclick="true" visible="1" >
						<button name="chat_window_channel_memberlist_btn_{type}_{channelID}" width="100%" height="100%" passivechildren="true" visible="1" interactive="false" enabled="1" color="invisible"
							onclicklua="
								if self:GetWidget('chat_window_channel_memberlist_parent_{type}_{channelID}'):IsVisible() then
									self:GetWidget('chat_window_channel_memberlist_parent_{type}_{channelID}'):FadeOut(100)
									self:GetWidget('chat_window_channel_chatoutputbuffer_parent_{type}_{channelID}'):ScaleWidth('100%', 250, false)
									mainUI.savedLocally.openMemberlists['{channelID}'] = nil
								else
									self:GetWidget('chat_window_channel_memberlist_parent_{type}_{channelID}'):FadeIn(250)
									self:GetWidget('chat_window_channel_chatoutputbuffer_parent_{type}_{channelID}'):ScaleWidth('-180s', 100, false)
									mainUI.savedLocally.openMemberlists['{channelID}'] = true
								end
							"
							oninstantiatelua="
								if (mainUI.savedLocally.openMemberlists) and (mainUI.savedLocally.openMemberlists['{channelID}']) then
									self:GetWidget('chat_window_channel_memberlist_parent_{type}_{channelID}'):FadeIn(250)
									self:GetWidget('chat_window_channel_chatoutputbuffer_parent_{type}_{channelID}'):ScaleWidth('-180s', 100, false)								
								end
							"
						>
							<panel align="center" valign="center">
								<frame texture="/ui/shared/frames/stnd_btn_up.tga" borderthickness="4s" color=".8 .8 .8 1" rendermode="grayscale" />
								<label name="chat_window_channel_memberlist_label_{type}_{channelID}" style="labelBase" noclick="1" outline="true" outlinecolor="0 0 0 0.5" y="-2" content="0" width="-5s" align="right" textalign="center" textvalign="center" font="maindyn_20" color="white" />
								<image texture="/ui/main/friends/textures/social.tga" x="-14s" width="28s" height="28s" valign="center" />
							</panel>
						</button>						
					</panel>
					
					<!-- Ignore Btn -->
					<instance name="iconLabelButton" id="chat_window_channel_ignore_btn_{type}_{channelID}" label="general_ignore"
						icon="/ui/_textures/icons/chat.tga" iconsize="95"
						x="-310s" width="95s" height="25s" align="right" valign="center" borderthickness="4s" visible="{isPM=0}"
					/>
					
					<!-- Friend Btn -->
					<instance name="iconLabelButton" id="chat_window_channel_friend_btn_{type}_{channelID}" label="general_add_friend"
						icon="/ui/main/friends/textures/icon_friend_remove.tga" iconsize="95"
						x="-168s" width="135s" height="25s" align="right" valign="center" borderthickness="4s" visible="{isPM=0}"
					/>
					
					<!-- Invite Btn -->
					<instance name="iconLabelButton" id="chat_window_channel_invite_btn_{type}_{channelID}" label="player_profile_invite"
						icon="/ui/main/notification/textures/party.tga" iconsize="95"
						x="-67s" width="95s" height="25s" align="right" valign="center" borderthickness="4s" visible="{isPM=0}"
					/>
					
					<!-- Min Btn -->
					<instance name="iconButton" id="chat_window_channel_minimise_btn_{type}_{channelID}"
						icon="/ui/main/shared/textures/minimize.tga"
						onclicklua="mainUI.chatManager.ClickedPinnedChatTab(self, [=[{channelName=-3}]=], '{channelID=-3}', false, true, '{type}')"
						x="{minimiseBtnX=-5s}" width="25s" height="25s" align="right" valign="center" borderthickness="4s"
					/>				
					
					<!-- Close Btn -->
					<instance name="iconButton" id="chat_window_channel_close_btn_{type}_{channelID}"
						icon="/ui/main/shared/textures/close.tga"
						onclicklua="mainUI.LeavePinnedChannel(self, '{channelID}')"
						visible="{showCloseButton=0}"
						x="-5s" width="25s" height="25s" align="right" valign="center" borderthickness="4s"
					/>					
				
				</panel>
			</panel>
			<panel noclick="1" y="36s" height="-72s" ><!-- Middle area -->
				<panel noclick="1" name="chat_window_channel_chatoutputbuffer_parent_{type}_{channelID}" >  <!-- Channel Output Buffer -->
					<chatoutputbuffer
						name="chat_window_channel_outputbuffer_{type}_{channelID}"
						group="chat_window_channel_outputbuffers"
						valign="top"
						textcolor="#f8f8f2"
						color="invisible"
						font="maindyn_18"
						scrolltexture="/ui/shared/textures/slider.tga"
						indent="32"
						paddingleft="4s"
						paddingright="4s"
						paddingbottom="4s"
						paddingtop="4s"
						shadow="true"
						outline="false"
						shadowoffset="1"
						oninstantiatelua=""
						scrollbarsize="24s"				
						maxhandleheight="48s"
						handlewidth="24s"
						minhandlesize="48s"
						maxhandlesize="48s"
						onfocuslua=""
						hscrollbar="0"
						horizontal="false"			
						onmouseoutlua=""
						onupdate=""
						oldmessagedarkfactor="0.7"
						onclicklua=""
						onmouseldownlua=""
						onmouseluplua=""
					/>	
				</panel>
				<panel noclick="1" name="chat_window_channel_memberlist_parent_{type}_{channelID}">  <!-- Member List if applicable -->	
					<listbox name="chat_window_channel_memberlist_listbox_{type}_{channelID}" style="simpleListbox" height="100%" width="-25s"
						color="invisible"
						itemheight="36s"
						scrollbaroffset="5s"
						select="true"
						highlightcolor="invisible"
						highlightbordercolor="invisible"
						exteriorscrollbars="true"
						scrollbarplaceholder="false"
						scrolltexture="/ui/shared/textures/slider.tga"
						scrollbarsize="24s"
						handleheight="48s"
						hscrollbar="0"
						horizontal="false"							
					/>					
				</panel>  			
			</panel>
			<panel noclick="1" valign="bottom" y="-2s" height="36s" > <!-- Lower Area -->
				<panel noclick="1" > <!-- Input Buffer --> 
					<frame texture="/ui/elements:text_input_dark" borderthickness="6s" noclick="1" height="36s" width="-18s" valign="bottom">
						<chatinputbuffer
							name="chat_window_channel_inputbuffer_{type}_{channelID}"
							x="8s" y="-8s"
							textcolor="1 1 1 1"
							color="invisible"
							font="maindyn_18"
							scrolltexture="/ui/_textures/elements/combobox.tga"
							indent="0"
							width="-85s"
							grow="true"
							valign="bottom"
							oninstantiatelua=""
							onesclua="self:SetFocus(false)"
							onmouseldownlua=""
							onfocuslua=""
							hscrollbar="0"
							horizontal="false"		
							onmouseoutlua=""
							onsizelua=""
						/>											
					</frame>					
				</panel>
				<panel noclick="1" >  <!-- Send Button -->
					<instance noclick="0" x="-5s" y="5s" height="25s" valign="top" width="64s" align="right"
						name="standardButton" id="chat_window_channel_inputbuffer_btn_{type}_{channelID}"
						label="general_send"
						font="maindyn_20"
						onclicklua=""
					/>						
				</panel>
				<panel noclick="1" >  <!-- Draggy Guy -->
				
				</panel>
			</panel>		
		</panel>	
	</template>
	
	<template name="chat_window_channel_tab_header_template" >
		<panel name="chat_window_channel_tab_header_{type}_{channelID}" group="chat_window_channel_tab_headers" height="32s" width="300s" color="invisible" passivechildren="0" sticky="1" stickytoinvis="0"
			onmouseluplua="
				mainUI.chatManager.stopTabDrag()
				if (CursorInside(self) and not mainUI.chatManager.justDragged) then
					mainUI.chatManager.ClickedPinnedChatTab(self, [=[{channelName=-3}]=], '{channelID=-3}', false, nil, '{type}')
				end
			"
			onmouseldownlua="
				mainUI.chatManager.justDragged = false
				mainUI.chatManager.startTabDrag(self)
			"
			onmouseoutlua="
				self:GetWidget('main_footer_chat_tab_{type}{channelID}_1'):SetTexture('/ui/main/footer/textures/chat_tab_off_l.tga')
				self:GetWidget('main_footer_chat_tab_{type}{channelID}_2'):SetTexture('/ui/main/footer/textures/chat_tab_off_c.tga')
				self:GetWidget('main_footer_chat_tab_{type}{channelID}_3'):SetTexture('/ui/main/footer/textures/chat_tab_off_r.tga')
			"
			onmouseoverlua="
				self:GetWidget('main_footer_chat_tab_{type}{channelID}_1'):SetTexture('/ui/main/footer/textures/chat_tab_on_l.tga')
				self:GetWidget('main_footer_chat_tab_{type}{channelID}_2'):SetTexture('/ui/main/footer/textures/chat_tab_on_c.tga')
				self:GetWidget('main_footer_chat_tab_{type}{channelID}_3'):SetTexture('/ui/main/footer/textures/chat_tab_on_r.tga')
			"		
			onrightclicklua="
				if ('{channelID}' == '-4') then
					ContextMenuTrigger.channelID = '{channelID}'
					ContextMenuTrigger.contextMenuArea = 5
					ContextMenuTrigger:Trigger(true)				
				elseif ('{channelID}' ~= '-3') then
					ContextMenuTrigger.channelID = '{channelID}'
					ContextMenuTrigger.contextMenuArea = 4
					ContextMenuTrigger:Trigger(true)
				end
			"				
		>
			<!-- The order of these widgets is important, they are accessed in script via it -->
			<image name="chat_window_channel_tab_header_frame_1_{type}_{channelID}" x="0" noclick="1" height="100%" width="50@" texture="/ui/main/footer/textures/chat_tab_off_l.tga" />
			<panel name="chat_window_channel_tab_header_frame_2_{type}_{channelID}" x="5s" width="-15s" noclick="1" height="100%" texture="/ui/main/footer/textures/chat_tab_off_c.tga" float="right" />
			<image name="chat_window_channel_tab_header_frame_3_{type}_{channelID}" x="14s" height="100%" align="right" width="100@" texture="/ui/main/footer/textures/chat_tab_off_r.tga" noclick="1" />
			<image name="chat_window_channel_tab_header_frame_4_{type}_{channelID}" x="2s" height="30s" width="30s" valign="center" texture="/ui/main/chat/textures/chat_min.tga" noclick="true" />
			
			<label name="chat_window_channel_tab_header_label_{type}_{channelID}" x="36s" width="-50s" group="chat_window_channel_tab_header_labels" noclick="1" textalign="left" textvalign="center" font="maindyn_18" color="white" outline="true" outlinecolor="0 0 0 0.5" content="{channelName}" />

		</panel>
	</template>	

	<template name="memberlist_entry_template">
		<button passivechildren="0" noclick="0" hmargin="0.15h" vmargin="0.15h" cangrab="true" dragexclusive="false" color="invisible"
			cursor="/core/cursors/arrow_right.cursor"
			oninstantiatelua="
				self:RegisterWatchLua('ChatChannelMember', function(sourceWidget, trigger)
						if (trigger.channelID == '{channelID=-1}') and (trigger.identID == ('{identID=-1}')) and (trigger.leave) then
							GetWidget('overlay_chat_channel{channelID=-1}_memberlist_listbox'):EraseListItemByValue('{identID=-1}')
						end
					end,
					false,
					nil,
					'identID', 'leave', 'channelID'
				)
				self:Sleep(1, function()
					RegisterRockingScrollingLabel(self, '{playerName}', 'maindyn_16', 0, self:GetChildren()[1]:GetChildren()[2]:GetChildren()[1])
				end)
				globalDraggerRegisterSource(self, 12)
			"
			onstartdraglua="
				local clientInfoDrag = LuaTrigger.GetTrigger('clientInfoDrag')
				clientInfoDrag.clientDraggingName			= '{playerName}'
				clientInfoDrag.clientDraggingUniqueID		= '{uniqueID}'
				clientInfoDrag.clientDraggingIdentID		= '{identID}'
				clientInfoDrag.clientDraggingCanSpectate	= false
				clientInfoDrag.clientDraggingIsFriend		= {isFriend}
				clientInfoDrag.clientDraggingIsOnline		= true
				clientInfoDrag.dragActive					= true

				clientInfoDrag:Trigger(false)
			"			
			onenddraglua="
				local clientInfoDrag = LuaTrigger.GetTrigger('clientInfoDrag')
				clientInfoDrag.dragActive			= false
				clientInfoDrag:Trigger(false)
			"
			onrightclicklua="
				ContextMenuTrigger.selectedUserIdentID 			= '{identID}'
				ContextMenuTrigger.selectedUserUsername 		= '{playerName}'
				ContextMenuTrigger.selectedUserIsInGame			= {inGame}
				ContextMenuTrigger.selectedUserIsInParty		= {inParty}
				ContextMenuTrigger.selectedUserIsInLobby		= {inLobby}
				ContextMenuTrigger.spectatableGame			= {spectatableGame}
				ContextMenuTrigger.contextMenuArea = 1
				ContextMenuTrigger:Trigger(true)
			"
			ondoubleclicklua="mainUI.chatManager.InitPrivateMessage('{identID}', ContextMenuTrigger.contextMenuArea, '{playerName}')"
			onmouseoverlua="self:SetColor('1 1 1 0.1')"
			onmouseoutlua="self:SetColor('1 1 1 0')"
		>
			<panel hmargin="1s" vmargin="1s" noclick="1">
				<panel width="100@" height="100%" noclick="1">
					<image align="center" valign="center" texture="{accountIcon=/ui/shared/textures/user_icon.tga}" noclick="1"/>
				</panel>
				<panel x="-0.3h" y="-0.3h" align="right" width="-125@" noclick="1"	>
					<label x="0.3h" y="0.3h" textvalign="center" color="{labelColor=white}" shadow="true" font="maindyn_16" content="{playerName}" noclick="1" />
				</panel>
			</panel>
		</button>
	</template>	
	
	<template name="chat_channel_joiner_entry">
		<panel height="40s" name="chat_channel_joiner_entry{id}">
			<panel name="chat_channel_joiner_entry{id}UserBody" noclick="true" visible="{isUser=true}">
				<button name="chat_channel_joiner_entry{id}UserButton" color="invisible" cangrab="true" dragexclusive="false">
					<frame texture="/ui/main/shared/frames/social_entry.tga" borderthickness="4s"/>
					
					<panel noclick="true" passivechildren="true">
						<!-- Icon, Maybe show group icon??
						<panel width="100@" height="100%">
							<image name="chat_channel_joiner_entry{id}UserIcon" texture="{userIcon=/ui/fe2/store/icons/account_icons/koalatea.tga}"/>
						</panel>
						-->
										
						<label name="chat_channel_joiner_entry{id}ChannelName" x="8s" height="60%" width="-45s" textvalign="center" style="labelBase" color="1 1 1 1" font="maindyn_20" content="{channelName}"/>
						<label name="chat_channel_joiner_entry{id}MemberCount" height="60%" textvalign="center" textalign="right" style="labelBase" color=".8 .8 1 1" font="maindyn_20" x="-8s" content="{memberCount}"/>
						<label name="chat_channel_joiner_entry{id}Topic" x="8s" y="-3s" height="40%" textvalign="center" textalign="left" valign="bottom" style="labelBase" color=".8 .8 .8 1" font="maindyn_14" content="{topic}"/>
						<label name="chat_channel_joiner_entry{id}Language" x="-8s" y="-3s" height="40%" textvalign="center" textalign="right" valign="bottom" style="labelBase" color=".7 .7 .7 1" font="maindyn_14" content="{language}"/>
						
					</panel>			
					<frame name="chat_channel_joiner_entry{id}UserDarken" color="0 0 0 0.5" texture="/ui/elements:rounded_Bg_white" borderthickness="0.5h" noclick="true" visible="false"/>
					<frame texture="/ui/elements:roundframe" color="0 0 0 1" borderthickness="0.6h" noclick="1"/>
				</button>
			</panel>
		</panel>
	</template>		
	
</package>
